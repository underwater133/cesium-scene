import{_ as A,af as S,v as L,x as B,c as P,o as N,j as w,a as b,t as X,F as j,ag as k,G}from"./chunks/framework.CeAxlD3m.js";import{C as D,a as h,M as o,b as y,T as F,c as x,d as W,e as R,S as H,f as J}from"./chunks/Viewer.BOTzFsmJ.js";import{u as Q}from"./chunks/useCesium.BCs2SxZ6.js";function Y(s,r,e,l,f,n){if(r<=0||e<=0||l<=0)throw Error("缩放倍数必须大于0");if(r===1&&e===1&&l===1)return;const m=s.boundingSphere.center,t=F.eastNorthUpToFixedFrame(m),d=o.inverse(t,new o),c=o.fromScale(new h(r,e,l)),g=o.multiply(c,d,new o),_=o.multiply(t,g,new o);s.modelMatrix=o.multiply(_,s.modelMatrix,new o)}function I(s,r,e,l,f,n){if(r===0&&e===0&&l===0)return;const m=s.boundingSphere.center,t=F.eastNorthUpToFixedFrame(m),d=o.inverse(t,new o),c=o.clone(o.IDENTITY);if(r!==0){const u=o.fromRotation(y.fromRotationX(x.toRadians(r)));o.multiply(u,c,c)}if(e!==0){const u=o.fromRotation(y.fromRotationY(x.toRadians(e)));o.multiply(u,c,c)}if(l!==0){const u=o.fromRotation(y.fromRotationZ(x.toRadians(l)));o.multiply(u,c,c)}const g=o.multiply(c,d,new o),_=o.multiply(t,g,new o);s.modelMatrix=o.multiply(_,s.modelMatrix,new o)}function Z(s,r,e,l,f,n){var m=new D.fromCartesian(f??s.boundingSphere.center),t=h.fromDegrees(r,e,m.height+l);const d=f??s.boundingSphere.center;n=n??s.modelMatrix;const c=new h(-d.x,-d.y,-d.z);let g=o.fromTranslation(c);o.multiply(g,n,g);let _=new h(1,0,0),u=new h(0,0,1),a=h.angleBetween(_,new h(d.x,d.y,0)),T=h.angleBetween(d,u);const p=y.fromRotationZ((d.y>0?-1:1)*a),M=y.fromRotationY(-T);let i=y.multiply(M,p,new y);i=o.fromRotationTranslation(i),o.multiply(i,g,i);const C=y.fromRotationZ(-Math.PI/2);let E=o.fromRotationTranslation(C);o.multiply(E,i,E);const U=F.eastNorthUpToFixedFrame(t),V=new h(-t.x,-t.y,-t.z);let v=o.fromTranslation(V);o.multiply(v,U,v),o.multiply(v,E,v);const O=o.fromTranslation(t);return o.multiply(O,v,new o)}const $={class:"click-info"},q={__name:"ThreeDTilesViewer",setup(s){let r=null,e=null,l=null,f=null,n=null;const m=S({longitude:0,latitude:0}),t=S({scale:1,longitude:0,latitude:0,height:0,rotateX:0,rotateY:0,rotateZ:0}),d=async()=>{if(typeof window>"u")return;const u=(await k(async()=>{const{default:C}=await import("./chunks/dat.gui.module.DNo137I2.js");return{default:C}},[])).default||await k(()=>import("./chunks/dat.gui.module.DNo137I2.js"),[]);n=new u.GUI,n.domElement.style.position="absolute",n.domElement.style.top="10px",n.domElement.style.left="10px";const a=n.addFolder("位置控制");a.add(t,"longitude",-180,180,1e-6).name("经度").onChange(()=>{e&&i.applyTransform()}),a.add(t,"latitude",-90,90,1e-6).name("纬度").onChange(()=>{e&&i.applyTransform()}),a.add(t,"height",0,1e4,1).name("高度").onChange(()=>{e&&i.applyTransform()}),a.open();const T=n.addFolder("缩放控制");T.add(t,"scale",.1,10,.1).name("缩放").onChange(()=>{e&&i.applyTransform()}),T.open();const p=n.addFolder("旋转控制");p.add(t,"rotateX",0,360,1).name("X轴旋转").onChange(()=>{e&&i.applyTransform()}),p.add(t,"rotateY",0,360,1).name("Y轴旋转").onChange(()=>{e&&i.applyTransform()}),p.add(t,"rotateZ",0,360,1).name("Z轴旋转").onChange(()=>{e&&i.applyTransform()}),p.open();const M=n.addFolder("操作"),i={locateModel:()=>{e&&r.zoomTo(e)},resetModel:()=>{if(!e)return;e.boundingSphere.center=R(l,!0),e.modelMatrix=R(f,!0);const C=D.fromCartesian(l);t.longitude=x.toDegrees(C.longitude),t.latitude=x.toDegrees(C.latitude),t.height=0,t.scale=1,t.rotateX=0,t.rotateY=0,t.rotateZ=0,n.updateDisplay()},applyTransform:()=>{e&&(e.modelMatrix=Z(e,t.longitude,t.latitude,t.height,l,f),Y(e,t.scale,t.scale,t.scale),I(e,t.rotateX,t.rotateY,t.rotateZ))}};M.add(i,"locateModel").name("定位模型"),M.add(i,"resetModel").name("重置模型"),M.open()},c=()=>{new H(r.scene.canvas).setInputAction(a=>{const T=r.scene.camera.pickEllipsoid(a.position,r.scene.globe.ellipsoid);let p=D.fromCartesian(T,r.scene.globe.ellipsoid,new D),M=x.toDegrees(p.longitude),i=x.toDegrees(p.latitude);m.longitude=M,m.latitude=i,console.log("点击坐标：",M,i)},J.LEFT_UP)},g=()=>{t.longitude=m.longitude,t.latitude=m.latitude,e&&(e.modelMatrix=Z(e,t.longitude,t.latitude,t.height,l,f),Y(e,t.scale,t.scale,t.scale),I(e,t.rotateX,t.rotateY,t.rotateZ),n&&n.updateDisplay())},_=()=>{const u="/cesium-scene/";e=new W({url:u+"3dtiles/Quaint_Village/tileset.json",maximumScreenSpaceError:1}),r.scene.primitives.add(e),e.readyPromise.then(()=>{const a=D.fromCartesian(e.boundingSphere.center),T=x.toDegrees(a.longitude),p=x.toDegrees(a.latitude);e.modelMatrix=Z(e,T,p,9),l=R(e.boundingSphere.center),f=R(e.modelMatrix),t.longitude=T,t.latitude=p,t.height=0,t.scale=1,t.rotateX=0,t.rotateY=0,t.rotateZ=0,r.zoomTo(e),d(),c()})};return L(()=>{r=Q("cesiumContainer"),_()}),B(()=>{n&&(n.destroy(),n=null)}),(u,a)=>(N(),P(j,null,[a[5]||(a[5]=w("div",{id:"cesiumContainer",style:{width:"100vw",height:"100vh"}},null,-1)),w("div",$,[a[4]||(a[4]=w("p",null,"点击坐标",-1)),w("p",null,[a[0]||(a[0]=b("经度：")),a[1]||(a[1]=w("br",null,null,-1)),b(X(m.longitude),1)]),w("p",null,[a[2]||(a[2]=b("纬度：")),a[3]||(a[3]=w("br",null,null,-1)),b(X(m.latitude),1)]),w("button",{class:"set-location-btn",onClick:g},"设置模型位置")])],64))}},z=A(q,[["__scopeId","data-v-0d3ca462"]]),nt=JSON.parse('{"title":"3DTiles查看器","description":"","frontmatter":{"layout":false,"title":"3DTiles查看器"},"headers":[],"relativePath":"scene/3DTiles查看器.md","filePath":"scene/3DTiles查看器.md"}'),K={name:"scene/3DTiles查看器.md"},rt=Object.assign(K,{setup(s){return(r,e)=>(N(),P("div",null,[G(z)]))}});export{nt as __pageData,rt as default};
