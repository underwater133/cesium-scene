import{x as V,_ as L,af as S,v as P,c as U,o as j,j as x,a as v,t as k,F as J,ag as F,G as z}from"./chunks/framework.CeAxlD3m.js";import{C as b,a as M,M as o,b as y,T as I,c as h,V as G,I as B,d as Q,e as R,S as W,f as H}from"./chunks/Viewer.DKn_iODQ.js";function Y(l,a,e,s,p,i){if(a<=0||e<=0||s<=0)throw Error("缩放倍数必须大于0");if(a===1&&e===1&&s===1)return;const m=l.boundingSphere.center,t=I.eastNorthUpToFixedFrame(m),c=o.inverse(t,new o),u=o.fromScale(new M(a,e,s)),f=o.multiply(u,c,new o),_=o.multiply(t,f,new o);l.modelMatrix=o.multiply(_,l.modelMatrix,new o)}function X(l,a,e,s,p,i){if(a===0&&e===0&&s===0)return;const m=l.boundingSphere.center,t=I.eastNorthUpToFixedFrame(m),c=o.inverse(t,new o),u=o.clone(o.IDENTITY);if(a!==0){const d=o.fromRotation(y.fromRotationX(h.toRadians(a)));o.multiply(d,u,u)}if(e!==0){const d=o.fromRotation(y.fromRotationY(h.toRadians(e)));o.multiply(d,u,u)}if(s!==0){const d=o.fromRotation(y.fromRotationZ(h.toRadians(s)));o.multiply(d,u,u)}const f=o.multiply(u,c,new o),_=o.multiply(t,f,new o);l.modelMatrix=o.multiply(_,l.modelMatrix,new o)}function Z(l,a,e,s,p,i){var m=new b.fromCartesian(p??l.boundingSphere.center),t=M.fromDegrees(a,e,m.height+s);const c=p??l.boundingSphere.center;i=i??l.modelMatrix;const u=new M(-c.x,-c.y,-c.z);let f=o.fromTranslation(u);o.multiply(f,i,f);let _=new M(1,0,0),d=new M(0,0,1),n=M.angleBetween(_,new M(c.x,c.y,0)),g=M.angleBetween(c,d);const T=y.fromRotationZ((c.y>0?-1:1)*n),w=y.fromRotationY(-g);let r=y.multiply(w,T,new y);r=o.fromRotationTranslation(r),o.multiply(r,f,r);const C=y.fromRotationZ(-Math.PI/2);let E=o.fromRotationTranslation(C);o.multiply(E,r,E);const N=I.eastNorthUpToFixedFrame(t),O=new M(-t.x,-t.y,-t.z);let D=o.fromTranslation(O);o.multiply(D,N,D),o.multiply(D,E,D);const A=o.fromTranslation(t);return o.multiply(A,D,new o)}function q(l,a={}){B.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIzZjEwMDUyMS1kZjJmLTRmZjUtODRkMy03YTMxZWY4MzEyMTQiLCJpZCI6MjYwMTkzLCJpYXQiOjE3MzMzNjQ5Nzh9.uAHIgn1GrmQG8VSYgojcdVsr8kR4kCr8cxyhwbD19jg",window.CESIUM_BASE_URL="/cesium/";const e=new G(l,a);return window.viewer=e,e.scene.globe.depthTestAgainstTerrain=!0,V(()=>{e.destroy()}),e}const $={class:"click-info"},K={__name:"ThreeDTilesViewer",setup(l){let a=null,e=null,s=null,p=null,i=null;const m=S({longitude:0,latitude:0}),t=S({scale:1,longitude:0,latitude:0,height:0,rotateX:0,rotateY:0,rotateZ:0}),c=async()=>{if(typeof window>"u")return;const d=(await F(async()=>{const{default:C}=await import("./chunks/dat.gui.module.DNo137I2.js");return{default:C}},[])).default||await F(()=>import("./chunks/dat.gui.module.DNo137I2.js"),[]);i=new d.GUI,i.domElement.style.position="absolute",i.domElement.style.top="10px",i.domElement.style.left="10px";const n=i.addFolder("位置控制");n.add(t,"longitude",-180,180,1e-6).name("经度").onChange(()=>{e&&r.applyTransform()}),n.add(t,"latitude",-90,90,1e-6).name("纬度").onChange(()=>{e&&r.applyTransform()}),n.add(t,"height",0,1e4,1).name("高度").onChange(()=>{e&&r.applyTransform()}),n.open();const g=i.addFolder("缩放控制");g.add(t,"scale",.1,10,.1).name("缩放").onChange(()=>{e&&r.applyTransform()}),g.open();const T=i.addFolder("旋转控制");T.add(t,"rotateX",0,360,1).name("X轴旋转").onChange(()=>{e&&r.applyTransform()}),T.add(t,"rotateY",0,360,1).name("Y轴旋转").onChange(()=>{e&&r.applyTransform()}),T.add(t,"rotateZ",0,360,1).name("Z轴旋转").onChange(()=>{e&&r.applyTransform()}),T.open();const w=i.addFolder("操作"),r={locateModel:()=>{e&&a.zoomTo(e)},resetModel:()=>{if(!e)return;e.boundingSphere.center=R(s,!0),e.modelMatrix=R(p,!0);const C=b.fromCartesian(s);t.longitude=h.toDegrees(C.longitude),t.latitude=h.toDegrees(C.latitude),t.height=0,t.scale=1,t.rotateX=0,t.rotateY=0,t.rotateZ=0,i.updateDisplay()},applyTransform:()=>{e&&(e.modelMatrix=Z(e,t.longitude,t.latitude,t.height,s,p),Y(e,t.scale,t.scale,t.scale),X(e,t.rotateX,t.rotateY,t.rotateZ))}};w.add(r,"locateModel").name("定位模型"),w.add(r,"resetModel").name("重置模型"),w.open()},u=()=>{new W(a.scene.canvas).setInputAction(n=>{const g=a.scene.camera.pickEllipsoid(n.position,a.scene.globe.ellipsoid);let T=b.fromCartesian(g,a.scene.globe.ellipsoid,new b),w=h.toDegrees(T.longitude),r=h.toDegrees(T.latitude);m.longitude=w,m.latitude=r,console.log("点击坐标：",w,r)},H.LEFT_UP)},f=()=>{t.longitude=m.longitude,t.latitude=m.latitude,e&&(e.modelMatrix=Z(e,t.longitude,t.latitude,t.height,s,p),Y(e,t.scale,t.scale,t.scale),X(e,t.rotateX,t.rotateY,t.rotateZ),i&&i.updateDisplay())},_=()=>{e=new Q({url:"/public/3dtiles/Quaint_Village/tileset.json",maximumScreenSpaceError:1}),a.scene.primitives.add(e),e.readyPromise.then(()=>{const d=b.fromCartesian(e.boundingSphere.center),n=h.toDegrees(d.longitude),g=h.toDegrees(d.latitude);e.modelMatrix=Z(e,n,g,9),s=R(e.boundingSphere.center),p=R(e.modelMatrix),t.longitude=n,t.latitude=g,t.height=0,t.scale=1,t.rotateX=0,t.rotateY=0,t.rotateZ=0,a.zoomTo(e),c(),u()})};return P(()=>{a=q("cesiumContainer"),_()}),V(()=>{i&&(i.destroy(),i=null)}),(d,n)=>(j(),U(J,null,[n[5]||(n[5]=x("div",{id:"cesiumContainer",style:{width:"100vw",height:"100vh"}},null,-1)),x("div",$,[n[4]||(n[4]=x("p",null,"点击坐标",-1)),x("p",null,[n[0]||(n[0]=v("经度：")),n[1]||(n[1]=x("br",null,null,-1)),v(k(m.longitude),1)]),x("p",null,[n[2]||(n[2]=v("纬度：")),n[3]||(n[3]=x("br",null,null,-1)),v(k(m.latitude),1)]),x("button",{class:"set-location-btn",onClick:f},"设置模型位置")])],64))}},tt=L(K,[["__scopeId","data-v-a7cd359a"]]),it=JSON.parse('{"title":"3DTiles查看器","description":"","frontmatter":{"layout":false,"title":"3DTiles查看器"},"headers":[],"relativePath":"scene/3DTiles查看器.md","filePath":"scene/3DTiles查看器.md"}'),et={name:"scene/3DTiles查看器.md"},rt=Object.assign(et,{setup(l){return(a,e)=>(j(),U("div",null,[z(tt)]))}});export{it as __pageData,rt as default};
