import{x as U,_ as L,af as S,v as P,c as V,o as j,j as x,a as v,t as k,F as J,ag as F,G as z}from"./chunks/framework.CeAxlD3m.js";import{C as b,a as M,M as o,b as y,T as I,c as h,V as G,I as B,d as Q,e as R,S as W,f as H}from"./chunks/Viewer.DKn_iODQ.js";function Y(l,a,e,s,f,r){if(a<=0||e<=0||s<=0)throw Error("缩放倍数必须大于0");if(a===1&&e===1&&s===1)return;const m=l.boundingSphere.center,t=I.eastNorthUpToFixedFrame(m),d=o.inverse(t,new o),c=o.fromScale(new M(a,e,s)),g=o.multiply(c,d,new o),_=o.multiply(t,g,new o);l.modelMatrix=o.multiply(_,l.modelMatrix,new o)}function X(l,a,e,s,f,r){if(a===0&&e===0&&s===0)return;const m=l.boundingSphere.center,t=I.eastNorthUpToFixedFrame(m),d=o.inverse(t,new o),c=o.clone(o.IDENTITY);if(a!==0){const u=o.fromRotation(y.fromRotationX(h.toRadians(a)));o.multiply(u,c,c)}if(e!==0){const u=o.fromRotation(y.fromRotationY(h.toRadians(e)));o.multiply(u,c,c)}if(s!==0){const u=o.fromRotation(y.fromRotationZ(h.toRadians(s)));o.multiply(u,c,c)}const g=o.multiply(c,d,new o),_=o.multiply(t,g,new o);l.modelMatrix=o.multiply(_,l.modelMatrix,new o)}function Z(l,a,e,s,f,r){var m=new b.fromCartesian(f??l.boundingSphere.center),t=M.fromDegrees(a,e,m.height+s);const d=f??l.boundingSphere.center;r=r??l.modelMatrix;const c=new M(-d.x,-d.y,-d.z);let g=o.fromTranslation(c);o.multiply(g,r,g);let _=new M(1,0,0),u=new M(0,0,1),n=M.angleBetween(_,new M(d.x,d.y,0)),T=M.angleBetween(d,u);const p=y.fromRotationZ((d.y>0?-1:1)*n),w=y.fromRotationY(-T);let i=y.multiply(w,p,new y);i=o.fromRotationTranslation(i),o.multiply(i,g,i);const C=y.fromRotationZ(-Math.PI/2);let E=o.fromRotationTranslation(C);o.multiply(E,i,E);const N=I.eastNorthUpToFixedFrame(t),O=new M(-t.x,-t.y,-t.z);let D=o.fromTranslation(O);o.multiply(D,N,D),o.multiply(D,E,D);const A=o.fromTranslation(t);return o.multiply(A,D,new o)}function q(l,a={}){B.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIzZjEwMDUyMS1kZjJmLTRmZjUtODRkMy03YTMxZWY4MzEyMTQiLCJpZCI6MjYwMTkzLCJpYXQiOjE3MzMzNjQ5Nzh9.uAHIgn1GrmQG8VSYgojcdVsr8kR4kCr8cxyhwbD19jg",window.CESIUM_BASE_URL="/cesium/";const e=new G(l,a);return window.viewer=e,e.scene.globe.depthTestAgainstTerrain=!0,U(()=>{e.destroy()}),e}const $={class:"click-info"},K={__name:"ThreeDTilesViewer",setup(l){let a=null,e=null,s=null,f=null,r=null;const m=S({longitude:0,latitude:0}),t=S({scale:1,longitude:0,latitude:0,height:0,rotateX:0,rotateY:0,rotateZ:0}),d=async()=>{if(typeof window>"u")return;const u=(await F(async()=>{const{default:C}=await import("./chunks/dat.gui.module.DNo137I2.js");return{default:C}},[])).default||await F(()=>import("./chunks/dat.gui.module.DNo137I2.js"),[]);r=new u.GUI,r.domElement.style.position="absolute",r.domElement.style.top="10px",r.domElement.style.left="10px";const n=r.addFolder("位置控制");n.add(t,"longitude",-180,180,1e-6).name("经度").onChange(()=>{e&&i.applyTransform()}),n.add(t,"latitude",-90,90,1e-6).name("纬度").onChange(()=>{e&&i.applyTransform()}),n.add(t,"height",0,1e4,1).name("高度").onChange(()=>{e&&i.applyTransform()}),n.open();const T=r.addFolder("缩放控制");T.add(t,"scale",.1,10,.1).name("缩放").onChange(()=>{e&&i.applyTransform()}),T.open();const p=r.addFolder("旋转控制");p.add(t,"rotateX",0,360,1).name("X轴旋转").onChange(()=>{e&&i.applyTransform()}),p.add(t,"rotateY",0,360,1).name("Y轴旋转").onChange(()=>{e&&i.applyTransform()}),p.add(t,"rotateZ",0,360,1).name("Z轴旋转").onChange(()=>{e&&i.applyTransform()}),p.open();const w=r.addFolder("操作"),i={locateModel:()=>{e&&a.zoomTo(e)},resetModel:()=>{if(!e)return;e.boundingSphere.center=R(s,!0),e.modelMatrix=R(f,!0);const C=b.fromCartesian(s);t.longitude=h.toDegrees(C.longitude),t.latitude=h.toDegrees(C.latitude),t.height=0,t.scale=1,t.rotateX=0,t.rotateY=0,t.rotateZ=0,r.updateDisplay()},applyTransform:()=>{e&&(e.modelMatrix=Z(e,t.longitude,t.latitude,t.height,s,f),Y(e,t.scale,t.scale,t.scale),X(e,t.rotateX,t.rotateY,t.rotateZ))}};w.add(i,"locateModel").name("定位模型"),w.add(i,"resetModel").name("重置模型"),w.open()},c=()=>{new W(a.scene.canvas).setInputAction(n=>{const T=a.scene.camera.pickEllipsoid(n.position,a.scene.globe.ellipsoid);let p=b.fromCartesian(T,a.scene.globe.ellipsoid,new b),w=h.toDegrees(p.longitude),i=h.toDegrees(p.latitude);m.longitude=w,m.latitude=i,console.log("点击坐标：",w,i)},H.LEFT_UP)},g=()=>{t.longitude=m.longitude,t.latitude=m.latitude,e&&(e.modelMatrix=Z(e,t.longitude,t.latitude,t.height,s,f),Y(e,t.scale,t.scale,t.scale),X(e,t.rotateX,t.rotateY,t.rotateZ),r&&r.updateDisplay())},_=()=>{const u="/cesium-scene/";e=new Q({url:u+"3dtiles/Quaint_Village/tileset.json",maximumScreenSpaceError:1}),a.scene.primitives.add(e),e.readyPromise.then(()=>{const n=b.fromCartesian(e.boundingSphere.center),T=h.toDegrees(n.longitude),p=h.toDegrees(n.latitude);e.modelMatrix=Z(e,T,p,9),s=R(e.boundingSphere.center),f=R(e.modelMatrix),t.longitude=T,t.latitude=p,t.height=0,t.scale=1,t.rotateX=0,t.rotateY=0,t.rotateZ=0,a.zoomTo(e),d(),c()})};return P(()=>{a=q("cesiumContainer"),_()}),U(()=>{r&&(r.destroy(),r=null)}),(u,n)=>(j(),V(J,null,[n[5]||(n[5]=x("div",{id:"cesiumContainer",style:{width:"100vw",height:"100vh"}},null,-1)),x("div",$,[n[4]||(n[4]=x("p",null,"点击坐标",-1)),x("p",null,[n[0]||(n[0]=v("经度：")),n[1]||(n[1]=x("br",null,null,-1)),v(k(m.longitude),1)]),x("p",null,[n[2]||(n[2]=v("纬度：")),n[3]||(n[3]=x("br",null,null,-1)),v(k(m.latitude),1)]),x("button",{class:"set-location-btn",onClick:g},"设置模型位置")])],64))}},tt=L(K,[["__scopeId","data-v-acc3303c"]]),rt=JSON.parse('{"title":"3DTiles查看器","description":"","frontmatter":{"layout":false,"title":"3DTiles查看器"},"headers":[],"relativePath":"scene/3DTiles查看器.md","filePath":"scene/3DTiles查看器.md"}'),et={name:"scene/3DTiles查看器.md"},it=Object.assign(et,{setup(l){return(a,e)=>(j(),V("div",null,[z(tt)]))}});export{rt as __pageData,it as default};
