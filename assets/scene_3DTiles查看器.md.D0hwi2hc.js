import{x as U,_ as L,af as S,v as P,c as V,o as j,j as x,a as v,t as k,F as J,ag as F,G as z}from"./chunks/framework.CeAxlD3m.js";import{C as b,a as M,M as o,b as y,T as I,c as h,V as G,I as B,d as Q,e as R,S as W,f as H}from"./chunks/Viewer.DKn_iODQ.js";function Y(l,a,t,s,f,i){if(a<=0||t<=0||s<=0)throw Error("缩放倍数必须大于0");if(a===1&&t===1&&s===1)return;const m=l.boundingSphere.center,e=I.eastNorthUpToFixedFrame(m),d=o.inverse(e,new o),c=o.fromScale(new M(a,t,s)),g=o.multiply(c,d,new o),_=o.multiply(e,g,new o);l.modelMatrix=o.multiply(_,l.modelMatrix,new o)}function X(l,a,t,s,f,i){if(a===0&&t===0&&s===0)return;const m=l.boundingSphere.center,e=I.eastNorthUpToFixedFrame(m),d=o.inverse(e,new o),c=o.clone(o.IDENTITY);if(a!==0){const u=o.fromRotation(y.fromRotationX(h.toRadians(a)));o.multiply(u,c,c)}if(t!==0){const u=o.fromRotation(y.fromRotationY(h.toRadians(t)));o.multiply(u,c,c)}if(s!==0){const u=o.fromRotation(y.fromRotationZ(h.toRadians(s)));o.multiply(u,c,c)}const g=o.multiply(c,d,new o),_=o.multiply(e,g,new o);l.modelMatrix=o.multiply(_,l.modelMatrix,new o)}function Z(l,a,t,s,f,i){var m=new b.fromCartesian(f??l.boundingSphere.center),e=M.fromDegrees(a,t,m.height+s);const d=f??l.boundingSphere.center;i=i??l.modelMatrix;const c=new M(-d.x,-d.y,-d.z);let g=o.fromTranslation(c);o.multiply(g,i,g);let _=new M(1,0,0),u=new M(0,0,1),n=M.angleBetween(_,new M(d.x,d.y,0)),T=M.angleBetween(d,u);const p=y.fromRotationZ((d.y>0?-1:1)*n),w=y.fromRotationY(-T);let r=y.multiply(w,p,new y);r=o.fromRotationTranslation(r),o.multiply(r,g,r);const C=y.fromRotationZ(-Math.PI/2);let E=o.fromRotationTranslation(C);o.multiply(E,r,E);const N=I.eastNorthUpToFixedFrame(e),O=new M(-e.x,-e.y,-e.z);let D=o.fromTranslation(O);o.multiply(D,N,D),o.multiply(D,E,D);const A=o.fromTranslation(e);return o.multiply(A,D,new o)}function q(l,a={}){B.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIzZjEwMDUyMS1kZjJmLTRmZjUtODRkMy03YTMxZWY4MzEyMTQiLCJpZCI6MjYwMTkzLCJpYXQiOjE3MzMzNjQ5Nzh9.uAHIgn1GrmQG8VSYgojcdVsr8kR4kCr8cxyhwbD19jg",window.CESIUM_BASE_URL="/cesium-scene/cesium/";const t=new G(l,a);return window.viewer=t,t.scene.globe.depthTestAgainstTerrain=!0,U(()=>{t.destroy()}),t}const $={class:"click-info"},K={__name:"ThreeDTilesViewer",setup(l){let a=null,t=null,s=null,f=null,i=null;const m=S({longitude:0,latitude:0}),e=S({scale:1,longitude:0,latitude:0,height:0,rotateX:0,rotateY:0,rotateZ:0}),d=async()=>{if(typeof window>"u")return;const u=(await F(async()=>{const{default:C}=await import("./chunks/dat.gui.module.DNo137I2.js");return{default:C}},[])).default||await F(()=>import("./chunks/dat.gui.module.DNo137I2.js"),[]);i=new u.GUI,i.domElement.style.position="absolute",i.domElement.style.top="10px",i.domElement.style.left="10px";const n=i.addFolder("位置控制");n.add(e,"longitude",-180,180,1e-6).name("经度").onChange(()=>{t&&r.applyTransform()}),n.add(e,"latitude",-90,90,1e-6).name("纬度").onChange(()=>{t&&r.applyTransform()}),n.add(e,"height",0,1e4,1).name("高度").onChange(()=>{t&&r.applyTransform()}),n.open();const T=i.addFolder("缩放控制");T.add(e,"scale",.1,10,.1).name("缩放").onChange(()=>{t&&r.applyTransform()}),T.open();const p=i.addFolder("旋转控制");p.add(e,"rotateX",0,360,1).name("X轴旋转").onChange(()=>{t&&r.applyTransform()}),p.add(e,"rotateY",0,360,1).name("Y轴旋转").onChange(()=>{t&&r.applyTransform()}),p.add(e,"rotateZ",0,360,1).name("Z轴旋转").onChange(()=>{t&&r.applyTransform()}),p.open();const w=i.addFolder("操作"),r={locateModel:()=>{t&&a.zoomTo(t)},resetModel:()=>{if(!t)return;t.boundingSphere.center=R(s,!0),t.modelMatrix=R(f,!0);const C=b.fromCartesian(s);e.longitude=h.toDegrees(C.longitude),e.latitude=h.toDegrees(C.latitude),e.height=0,e.scale=1,e.rotateX=0,e.rotateY=0,e.rotateZ=0,i.updateDisplay()},applyTransform:()=>{t&&(t.modelMatrix=Z(t,e.longitude,e.latitude,e.height,s,f),Y(t,e.scale,e.scale,e.scale),X(t,e.rotateX,e.rotateY,e.rotateZ))}};w.add(r,"locateModel").name("定位模型"),w.add(r,"resetModel").name("重置模型"),w.open()},c=()=>{new W(a.scene.canvas).setInputAction(n=>{const T=a.scene.camera.pickEllipsoid(n.position,a.scene.globe.ellipsoid);let p=b.fromCartesian(T,a.scene.globe.ellipsoid,new b),w=h.toDegrees(p.longitude),r=h.toDegrees(p.latitude);m.longitude=w,m.latitude=r,console.log("点击坐标：",w,r)},H.LEFT_UP)},g=()=>{e.longitude=m.longitude,e.latitude=m.latitude,t&&(t.modelMatrix=Z(t,e.longitude,e.latitude,e.height,s,f),Y(t,e.scale,e.scale,e.scale),X(t,e.rotateX,e.rotateY,e.rotateZ),i&&i.updateDisplay())},_=()=>{const u="/cesium-scene/";t=new Q({url:u+"3dtiles/Quaint_Village/tileset.json",maximumScreenSpaceError:1}),a.scene.primitives.add(t),t.readyPromise.then(()=>{const n=b.fromCartesian(t.boundingSphere.center),T=h.toDegrees(n.longitude),p=h.toDegrees(n.latitude);t.modelMatrix=Z(t,T,p,9),s=R(t.boundingSphere.center),f=R(t.modelMatrix),e.longitude=T,e.latitude=p,e.height=0,e.scale=1,e.rotateX=0,e.rotateY=0,e.rotateZ=0,a.zoomTo(t),d(),c()})};return P(()=>{a=q("cesiumContainer"),_()}),U(()=>{i&&(i.destroy(),i=null)}),(u,n)=>(j(),V(J,null,[n[5]||(n[5]=x("div",{id:"cesiumContainer",style:{width:"100vw",height:"100vh"}},null,-1)),x("div",$,[n[4]||(n[4]=x("p",null,"点击坐标",-1)),x("p",null,[n[0]||(n[0]=v("经度：")),n[1]||(n[1]=x("br",null,null,-1)),v(k(m.longitude),1)]),x("p",null,[n[2]||(n[2]=v("纬度：")),n[3]||(n[3]=x("br",null,null,-1)),v(k(m.latitude),1)]),x("button",{class:"set-location-btn",onClick:g},"设置模型位置")])],64))}},ee=L(K,[["__scopeId","data-v-0d3ca462"]]),ie=JSON.parse('{"title":"3DTiles查看器","description":"","frontmatter":{"layout":false,"title":"3DTiles查看器"},"headers":[],"relativePath":"scene/3DTiles查看器.md","filePath":"scene/3DTiles查看器.md"}'),te={name:"scene/3DTiles查看器.md"},re=Object.assign(te,{setup(l){return(a,t)=>(j(),V("div",null,[z(ee)]))}});export{ie as __pageData,re as default};
